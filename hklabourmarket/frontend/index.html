<!doctype html>
<html lang="en">

<head>
    <title>HK Labour Market</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,600,700,800,900" rel="stylesheet">

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="css/style.css">

    <!-- D3.js -->
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>


    <style>
        .make-me-sticky {
            position: sticky;
            top: 0;
        }
        
        .bottom-one {
            margin-bottom: 1cm;
        }
        /* D3.js */
        
        g.arc path {
            stroke: #828282;
            stroke-width: 0.5;
        }
        
        g.arc text {
            font-size: 10px;
        }
        
        .label {
            display: flex;
            align-items: center;
        }
        
        .button {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .slider {
            -webkit-appearance: none;
            width: 100%;
            height: 15px;
            border-radius: 5px;
            background: #d3d3d3;
            outline: none;
            opacity: 0.7;
            -webkit-transition: opacity .15s ease-in-out;
            transition: opacity .15s ease-in-out;
        }
        
        .slider:hover {
            opacity: 1;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: #4CAF50;
            cursor: pointer;
        }
        
        .slider::-moz-range-thumb {
            width: 25px;
            height: 25px;
            border: 0;
            border-radius: 50%;
            background: #4CAF50;
            cursor: pointer;
        }
    </style>
</head>

<body>

    <div class="wrapper d-flex align-items-stretch">
        <nav id="sidebar">

            <div class="make-me-sticky">

                <div class="custom-menu">
                    <button type="button" id="sidebarCollapse" class="btn btn-primary">
                        <i class="fa fa-bars"></i>
                        <span class="sr-only">Toggle Menu</span>
                    </button>
                </div>
                <h1><a href="index.html" class="logo">HK Labour Market</a></h1>
                <ul class="list-unstyled components mb-5">
                    <li class="active">
                        <a href="index.html"><span class="fa fa-home mr-3"></span> Homepage</a>
                    </li>
                    <li>
                        <a href="#employment-and-vacancies"><span class="fa fa-line-chart mr-3"></span> Employment and
                            vacancies</a>
                    </li>
                    <li>
                        <a href="#employment-earnings"><span class="fa fa-line-chart mr-3"></span> Employment
                            earnings</a>
                    </li>
                    <li>
                        <a href="#hours-of-work"><span class="fa fa-line-chart mr-3"></span> Hours of work</a>
                    </li>
                    <li>
                        <a href="#training-needs"><span class="fa fa-line-chart mr-3"></span> Training needs</a>
                    </li>
                    <li>
                        <a href="#discussion"><span class="fa fa-comments mr-3"></span> Discussion</a>
                    </li>
                </ul>

            </div>

        </nav>


        <!-- Page Content  -->
        <div id="content" class="p-4 p-md-5 pt-5">
            <div id="introduction">

                <h2 class="mb-4">Hong Kong Labour Market Data Visualization</h2>
                <p>Labour market is an important determinant of economic development. In a context of complex and dynamic labour market, gathering intelligence on labour market data, including but not limited to employment and vacancies statistics, labour
                    treatment, and skills needs, can identify and understand issues in the labour market, inform decisions about employment policies, evaluate the benefits and costs of policies, match supply to current demand for skills and help enterprises
                    and workers adapt to change.</p>
                <p>This page discusses about various concerns of school graduates entering labor market, policy makers, and educational institutes. We provide data visualization on Hong Kong labour market data to provide clear pictures of the current labour
                    market situation and answer the following questions:</p>
                <li>What is the best industry and occupation for one to enter as a fresh graduate, based on his/her skills and interests, as well as the market conditions (saturation level and salary)?</li>
                <li>How would one select a program of study in school that can meet the market demand and his/her personal interests?
                </li>
                <li>Which industries and occupations have the brightest future and, therefore, requiring educational institutes to direct more teaching resources and to encourage student enrollments in?</li>
                <li>Which industries and occupations have the highest potentials and can be boosted further with policies to attract companies and talents?</li>
                <li>Which demographic groups (age, education level, sex) are the most disadvantaged and will need government assistance on improving the industry outlook and plans for re-training of the current labor force?</li>
                <li>What types of training programs are most beneficial to the workforce and students?</li>

                <p class="bottom-one"></p>
                <hr>
            </div>


            <div id="employment-and-vacancies">
                <h3 class="mb-4">Employment and vacancies</h3>




                <!-- Treemap -->
                <div id="employment-treemap">
                    <script>
                        d3.csv("https://raw.githubusercontent.com/michaelfong2017/michaelfong2017.github.io/master/hklabourmarket/frontend/csv/employment.csv", function(data) {
                            var nestedData = d3.nest()
                                .key(function(d) {
                                    return d.quarter;
                                })
                                .key(function(d) {
                                    return d.industry_section;
                                })
                                .key(function(d) {
                                    return d.industry_division;
                                })
                                .rollup(function(d) {
                                    var children = [];
                                    d.forEach(function(dSub) {
                                        var keys = Object.keys(dSub);
                                        keys.forEach((key) => {
                                            // number_of_persons_engaged_total,number_of_persons_engaged_male,
                                            // number_of_persons_engaged_female,number_of_vacancies,number_of_establishments
                                            if (key.startsWith("number")) {
                                                children.push(dSub[key]);
                                            }
                                        });
                                    })
                                    return children;
                                })
                                .entries(data);

                            console.log(nestedData)


                            /* Metadata */
                            quarters = [
                                "2000 Q1", "2000 Q2", "2000 Q3", "2000 Q4",
                                "2001 Q1", "2001 Q2", "2001 Q3", "2001 Q4",
                                "2002 Q1", "2002 Q2", "2002 Q3", "2002 Q4",
                                "2003 Q1", "2003 Q2", "2003 Q3", "2003 Q4",
                                "2004 Q1", "2004 Q2", "2004 Q3", "2004 Q4",
                                "2005 Q1", "2005 Q2", "2005 Q3", "2005 Q4",
                                "2006 Q1", "2006 Q2", "2006 Q3", "2006 Q4",
                                "2007 Q1", "2007 Q2", "2007 Q3", "2007 Q4",
                                "2008 Q1", "2008 Q2", "2008 Q3", "2008 Q4",
                                "2009 Q1", "2009 Q2", "2009 Q3", "2009 Q4",
                                "2010 Q1", "2010 Q2", "2010 Q3", "2010 Q4",
                                "2011 Q1", "2011 Q2", "2011 Q3", "2011 Q4",
                                "2012 Q1", "2012 Q2", "2012 Q3", "2012 Q4",
                                "2013 Q1", "2013 Q2", "2013 Q3", "2013 Q4",
                                "2014 Q1", "2014 Q2", "2014 Q3", "2014 Q4",
                                "2015 Q1", "2015 Q2", "2015 Q3", "2015 Q4",
                                "2016 Q1", "2016 Q2", "2016 Q3", "2016 Q4",
                                "2017 Q1", "2017 Q2", "2017 Q3", "2017 Q4",
                                "2018 Q1", "2018 Q2", "2018 Q3", "2018 Q4",
                                "2019 Q1", "2019 Q2", "2019 Q3", "2019 Q4",
                                "2020 Q1", "2020 Q2"
                            ]

                            var keys = []
                            nestedData[0].values.forEach((d) => keys.push(d.key))
                            console.log(keys)
                            color = d3.scaleOrdinal().domain(keys)
                                .range(d3.schemeSet3);


                            var treemapLayout = d3.treemap();
                            treemapLayout
                                .tile(d3.treemapBinary)
                                .size([1000, 600])
                                .paddingOuter(12);


                            /* Slider */
                            var label = d3.select("#employment-treemap")
                                .append("label")
                                .attr("class", "label")


                            var interval = null;
                            var button = label.append("button")
                                .attr("class", "button")
                                .style("width", "5em")
                                .style("margin-right", "0.6em")
                                .style("height", "36px")
                                .style("font-size", "20px")
                                .text("Play")
                                .on("click", function() {
                                    if (interval == null) {
                                        d3.select(this).text("Pause")
                                        interval = setInterval(function() {
                                            if (slider.value == 81) {
                                                // slider.value = 0
                                                button.text("Play")
                                                clearInterval(interval)
                                                interval = null
                                            } else {
                                                slider.value++;
                                            }

                                            d3.select("output").text(quarters[slider.value])
                                            update(slider.value)
                                        }, 500);
                                    } else if (interval != null) {
                                        d3.select(this).text("Play")
                                        clearInterval(interval)
                                        interval = null
                                    }

                                })

                            label.append("input")
                                .attr("type", "range")
                                .attr("min", 0)
                                .attr("max", 81)
                                .attr("step", "1")
                                .attr("value", 81)
                                .style("width", "800px")
                                .attr("id", "quarter")
                                .attr("class", "slider")
                                .on("input", function input() {
                                    d3.select("output").text(quarters[slider.value])
                                    update(slider.value)
                                });

                            var slider = document.getElementById("quarter");

                            var output = label.append("output")
                                .style("margin-left", "0.4em")
                                .style("width", "120px")
                                .style("font-size", "24px")
                                .text(quarters[slider.value])




                            var svg = d3.select("#employment-treemap").append("svg")
                                .attr("width", 1500)
                                .attr("height", 800)


                            var chart_group = svg.append("g");
                            chart_group
                                .attr("transform", "translate(0,50)");

                            var tooltip = d3.select("body")
                                .append("div")
                                .style("opacity", 1)
                                .attr("class", "tooltip")
                                .style("width", "300px")
                                .style("background-color", "black")
                                .style("border-radius", "5px")
                                .style("padding", "10px")
                                .style("color", "white")
                                .style("white-space", "pre-wrap")


                            function update(quarter_i) {
                                var root = d3.hierarchy(nestedData[quarter_i], function(d) {
                                        return d.values;
                                    })
                                    .sum(function(d) {
                                        if (d.value != null) {
                                            return d.value[0];
                                        }
                                    });

                                treemapLayout(root);


                                /* For displaying other data */
                                var root_male = d3.hierarchy(nestedData[quarter_i], function(d) {
                                        return d.values;
                                    })
                                    .sum(function(d) {
                                        if (d.value != null) {
                                            return d.value[1];
                                        }
                                    });
                                var root_female = d3.hierarchy(nestedData[quarter_i], function(d) {
                                        return d.values;
                                    })
                                    .sum(function(d) {
                                        if (d.value != null) {
                                            return d.value[2];
                                        }
                                    });
                                var root_vacancies = d3.hierarchy(nestedData[quarter_i], function(d) {
                                        return d.values;
                                    })
                                    .sum(function(d) {
                                        if (d.value != null) {
                                            return d.value[3];
                                        }
                                    });
                                var root_establishments = d3.hierarchy(nestedData[quarter_i], function(d) {
                                        return d.values;
                                    })
                                    .sum(function(d) {
                                        if (d.value != null) {
                                            return d.value[4];
                                        }
                                    });




                                chart_group.selectAll('rect')
                                    .data(root.descendants(), function(d) {
                                        return d.values
                                    })
                                    .enter()
                                    .append('rect')
                                    .attr('x', function(d) {
                                        return d.x0;
                                    })
                                    .attr('y', function(d) {
                                        return d.y0;
                                    })
                                    .attr('width', function(d) {
                                        return d.x1 - d.x0;
                                    })
                                    .attr('height', function(d) {
                                        return d.y1 - d.y0;
                                    })
                                    .style("stroke", "black")
                                    .style("fill", d => {
                                        while (d.depth > 1) d = d.parent;
                                        return color(d.data.key);
                                    })
                                    // .on("mouseover", (d) => console.log(d[1].reduce((a, b) => a + b).toFixed(1)));
                                    .on("mouseover", (d) => {
                                        var node = root.descendants().filter(function(des) {
                                            return des.depth == d.depth
                                        }).filter(function(des) {
                                            return des.data.key == d.data.key
                                        });
                                        var node_male = root_male.descendants().filter(function(des) {
                                            return des.depth == d.depth
                                        }).filter(function(des) {
                                            return des.data.key == d.data.key
                                        });
                                        var node_female = root_female.descendants().filter(function(des) {
                                            return des.depth == d.depth
                                        }).filter(function(des) {
                                            return des.data.key == d.data.key
                                        });
                                        var node_vacancies = root_vacancies.descendants().filter(function(des) {
                                            return des.depth == d.depth
                                        }).filter(function(des) {
                                            return des.data.key == d.data.key
                                        });
                                        var node_establishments = root_establishments.descendants().filter(function(des) {
                                            return des.depth == d.depth
                                        }).filter(function(des) {
                                            return des.data.key == d.data.key
                                        });
                                        tooltip.style("visibility", "visible").text(
                                            "Industry section / Industry division: " + (d.data.key.startsWith("20") ? "All" : d.data.key) + "\n" +
                                            "Number of persons engaged (Total): " + node[0].value + "\n" +
                                            "Number of persons engaged (Male): " + node_male[0].value + "\n" +
                                            "Number of persons engaged (Female): " + node_female[0].value + "\n" +
                                            "Number of vacancies: " + node_vacancies[0].value + "\n" +
                                            "Number of establishments: " + node_establishments[0].value
                                        )
                                    })
                                    .on("mousemove", function() {
                                        return tooltip.style("top",
                                            (d3.event.pageY - 10) + "px").style("left", (d3.event.pageX + 10) + "px");
                                    })
                                    .on("mouseout", function() {
                                        return tooltip.style("visibility", "hidden");
                                    });

                            }

                            update(81)



                            /* Legend */
                            var legend = svg.append("g");
                            legend
                                .attr("transform", "translate(960,0)");


                            legend.append("rect")
                                .attr('x', 70)
                                .attr('y', 70)
                                .attr('width', 500)
                                .attr('height', 540)
                                .style("stroke", "black")
                                .style("fill", "black")


                            // Add one dot in the legend for each name.
                            legend.selectAll("mydots")
                                .data(keys)
                                .enter()
                                .append("circle")
                                .attr("cx", 100)
                                .attr("cy", function(d, i) {
                                    return 100 + i * 30
                                }) // 100 is where the first dot appears. 25 is the distance between dots
                                .attr("r", 7)
                                .style("fill", function(d, i) {
                                    return color(i)
                                })

                            // Add one dot in the legend for each name.
                            legend.selectAll("mylabels")
                                .data(keys)
                                .enter()
                                .append("text")
                                .attr("x", 120)
                                .attr("y", function(d, i) {
                                    return 100 + i * 30
                                }) // 100 is where the first dot appears. 25 is the distance between dots
                                .style("fill", function(d, i) {
                                    return color(i)
                                })
                                .text(function(d) {
                                    return d
                                })
                                .attr("text-anchor", "left")
                                .style("alignment-baseline", "middle");


                            /* Title */
                            svg.append("text")
                                .attr("x", 8)
                                .attr("y", 30)
                                .attr("font-size", "22px")
                                .style('fill', '#808080')
                                .text("Total number of people engaged by Industry section / Industry division")

                        });
                    </script>
                </div>

                <p class="bottom-one"></p>
                <p>Interpret your result here.</p>
                <p class="bottom-one"></p>



                <!-- Vacancies and Graduates -->

                <div class='tableauPlaceholder' id='viz1605111289246' style='position: relative'><noscript><a
                            href='#'><img alt=' '
                                src='https:&#47;&#47;public.tableau.com&#47;static&#47;images&#47;Ho&#47;HoursofWork&#47;VacanciesandGraduates&#47;1_rss.png'
                                style='border: none' /></a></noscript><object class='tableauViz' style='display:none;'>
                        <param name='host_url' value='https%3A%2F%2Fpublic.tableau.com%2F' />
                        <param name='embed_code_version' value='3' />
                        <param name='site_root' value='' />
                        <param name='name' value='HoursofWork&#47;VacanciesandGraduates' />
                        <param name='tabs' value='no' />
                        <param name='toolbar' value='yes' />
                        <param name='static_image'
                            value='https:&#47;&#47;public.tableau.com&#47;static&#47;images&#47;Ho&#47;HoursofWork&#47;VacanciesandGraduates&#47;1.png' />
                        <param name='animate_transition' value='yes' />
                        <param name='display_static_image' value='yes' />
                        <param name='display_spinner' value='yes' />
                        <param name='display_overlay' value='yes' />
                        <param name='display_count' value='yes' />
                        <param name='language' value='zh-Hant' />
                        <param name='filter' value='publish=yes' /></object></div>
                <script type='text/javascript'>
                    var divElement = document.getElementById('viz1605111289246');
                    var vizElement = divElement.getElementsByTagName('object')[0];
                    vizElement.style.width = '100%';
                    vizElement.style.height = (divElement.offsetWidth * 0.75) + 'px';
                    var scriptElement = document.createElement('script');
                    scriptElement.src = 'https://public.tableau.com/javascripts/api/viz_v1.js';
                    vizElement.parentNode.insertBefore(scriptElement, vizElement);
                </script>


                <p class="bottom-one"></p>
                <p>Interpret your result here.</p>
                <p class="bottom-one"></p>


                <!-- Employment by Industry and Gender -->
                <div class='tableauPlaceholder' id='viz1605248696851' style='position: relative'><noscript><a
                            href='#'><img alt=' '
                                src='https:&#47;&#47;public.tableau.com&#47;static&#47;images&#47;PC&#47;PCHG55Y6M&#47;1_rss.png'
                                style='border: none' /></a></noscript><object class='tableauViz' style='display:none;'>
                        <param name='host_url' value='https%3A%2F%2Fpublic.tableau.com%2F' />
                        <param name='embed_code_version' value='3' />
                        <param name='path' value='shared&#47;PCHG55Y6M' />
                        <param name='toolbar' value='yes' />
                        <param name='static_image'
                            value='https:&#47;&#47;public.tableau.com&#47;static&#47;images&#47;PC&#47;PCHG55Y6M&#47;1.png' />
                        <param name='animate_transition' value='yes' />
                        <param name='display_static_image' value='yes' />
                        <param name='display_spinner' value='yes' />
                        <param name='display_overlay' value='yes' />
                        <param name='display_count' value='yes' />
                        <param name='language' value='en' /></object></div>
                <script type='text/javascript'>
                    var divElement = document.getElementById('viz1605248696851');
                    var vizElement = divElement.getElementsByTagName('object')[0];
                    vizElement.style.width = '100%';
                    vizElement.style.height = (divElement.offsetWidth * 0.75) + 'px';
                    var scriptElement = document.createElement('script');
                    scriptElement.src = 'https://public.tableau.com/javascripts/api/viz_v1.js';
                    vizElement.parentNode.insertBefore(scriptElement, vizElement);
                </script>


                <p class="bottom-one"></p>
                <p>Interpret your result here.</p>
                <p class="bottom-one"></p>

                <!-- Vacancies by industry -->
                <div class='tableauPlaceholder' id='viz1605249042961' style='position: relative'><noscript><a
                            href='#'><img alt=' '
                                src='https:&#47;&#47;public.tableau.com&#47;static&#47;images&#47;Ho&#47;HoursofWork&#47;VacanciesbyIndustry&#47;1_rss.png'
                                style='border: none' /></a></noscript><object class='tableauViz' style='display:none;'>
                        <param name='host_url' value='https%3A%2F%2Fpublic.tableau.com%2F' />
                        <param name='embed_code_version' value='3' />
                        <param name='site_root' value='' />
                        <param name='name' value='HoursofWork&#47;VacanciesbyIndustry' />
                        <param name='tabs' value='no' />
                        <param name='toolbar' value='yes' />
                        <param name='static_image'
                            value='https:&#47;&#47;public.tableau.com&#47;static&#47;images&#47;Ho&#47;HoursofWork&#47;VacanciesbyIndustry&#47;1.png' />
                        <param name='animate_transition' value='yes' />
                        <param name='display_static_image' value='yes' />
                        <param name='display_spinner' value='yes' />
                        <param name='display_overlay' value='yes' />
                        <param name='display_count' value='yes' />
                        <param name='language' value='en' /></object></div>
                <script type='text/javascript'>
                    var divElement = document.getElementById('viz1605249042961');
                    var vizElement = divElement.getElementsByTagName('object')[0];
                    vizElement.style.width = '100%';
                    vizElement.style.height = (divElement.offsetWidth * 0.75) + 'px';
                    var scriptElement = document.createElement('script');
                    scriptElement.src = 'https://public.tableau.com/javascripts/api/viz_v1.js';
                    vizElement.parentNode.insertBefore(scriptElement, vizElement);
                </script>


                <p class="bottom-one"></p>
                <p>Interpret your result here.</p>


                <p class="bottom-one"></p>
                <hr>
            </div>


            <div id="employment-earnings">
                <h3 class="mb-4">Employment earnings</h3>


                <p class="bottom-one"></p>
                <hr>
            </div>


            <div id="hours-of-work">
                <h3 class="mb-4">Hours of work</h3>

                <!-- Heat map -->
                <div class='tableauPlaceholder' id='viz1605098134736' style='position: relative'><noscript><a
                            href='#'><img alt=' '
                                src='https:&#47;&#47;public.tableau.com&#47;static&#47;images&#47;Ho&#47;HoursofWork&#47;HoursofWorkbyIndustry&#47;1_rss.png'
                                style='border: none' /></a></noscript><object class='tableauViz' style='display:none;'>
                        <param name='host_url' value='https%3A%2F%2Fpublic.tableau.com%2F' />
                        <param name='embed_code_version' value='3' />
                        <param name='site_root' value='' />
                        <param name='name' value='HoursofWork&#47;HoursofWorkbyIndustry' />
                        <param name='tabs' value='no' />
                        <param name='toolbar' value='yes' />
                        <param name='static_image'
                            value='https:&#47;&#47;public.tableau.com&#47;static&#47;images&#47;Ho&#47;HoursofWork&#47;HoursofWorkbyIndustry&#47;1.png' />
                        <param name='animate_transition' value='yes' />
                        <param name='display_static_image' value='yes' />
                        <param name='display_spinner' value='yes' />
                        <param name='display_overlay' value='yes' />
                        <param name='display_count' value='yes' />
                        <param name='language' value='zh-Hant' />
                        <param name='filter' value='publish=yes' /></object></div>
                <script type='text/javascript'>
                    var divElement = document.getElementById('viz1605098134736');
                    var vizElement = divElement.getElementsByTagName('object')[0];
                    vizElement.style.width = '100%';
                    vizElement.style.height = (divElement.offsetWidth * 0.75) + 'px';
                    var scriptElement = document.createElement('script');
                    scriptElement.src = 'https://public.tableau.com/javascripts/api/viz_v1.js';
                    vizElement.parentNode.insertBefore(scriptElement, vizElement);
                </script>


                <p class="bottom-one"></p>
                <p>Interpret your result here.</p>


                <p class="bottom-one"></p>
                <hr>
            </div>


            <div id="training-needs">
                <h3 class="mb-4">Training needs</h3>

                <script>
                    var data = {
                        "name": "All",
                        "children": [{
                            "name": "經理及行政級人員、專業人員與輔助專業人員 Managers and administrators, professionals and associate professionals",
                            "children": [{
                                "training": "Yes",
                                "children": [{
                                    "type": 0,
                                    "value": 120.3
                                }, {
                                    "type": 1,
                                    "value": 57.1
                                }, {
                                    "type": 2,
                                    "value": 52.2
                                }, {
                                    "type": 3,
                                    "value": 38.3
                                }, {
                                    "type": 4,
                                    "value": 35.5
                                }, {
                                    "type": 5,
                                    "value": 0
                                }, {
                                    "type": 6,
                                    "value": 0
                                }, {
                                    "type": 7,
                                    "value": 0
                                }, {
                                    "type": 8,
                                    "value": 0
                                }]
                            }, {
                                "training": "No",
                                "value": 1239
                            }]
                        }, {
                            "name": "文書支援人員 Clerical support workers",
                            "children": [{
                                "training": "Yes",
                                "children": [{
                                    "type": 0,
                                    "value": 19.6
                                }, {
                                    "type": 1,
                                    "value": 29.2
                                }, {
                                    "type": 2,
                                    "value": 0
                                }, {
                                    "type": 3,
                                    "value": 22.6
                                }, {
                                    "type": 4,
                                    "value": 0
                                }, {
                                    "type": 5,
                                    "value": 21.3
                                }, {
                                    "type": 6,
                                    "value": 19.2
                                }, {
                                    "type": 7,
                                    "value": 0
                                }, {
                                    "type": 8,
                                    "value": 0
                                }]
                            }, {
                                "training": "No",
                                "value": 378.3
                            }]
                        }, {
                            "name": "服務工作及銷售人員 Service and sales workers",
                            "children": [{
                                "training": "Yes",
                                "children": [{
                                    "type": 0,
                                    "value": 36.5
                                }, {
                                    "type": 1,
                                    "value": 16.8
                                }, {
                                    "type": 2,
                                    "value": 0
                                }, {
                                    "type": 3,
                                    "value": 22.9
                                }, {
                                    "type": 4,
                                    "value": 0
                                }, {
                                    "type": 5,
                                    "value": 16.1
                                }, {
                                    "type": 6,
                                    "value": 0
                                }, {
                                    "type": 7,
                                    "value": 15.3
                                }, {
                                    "type": 8,
                                    "value": 0
                                }]
                            }, {
                                "training": "No",
                                "value": 519.4
                            }]
                        }, {
                            "name": "工藝及有關人員、機台及機器操作員及裝配員 Craft and related workers, plant and machine operators and assemblers",
                            "children": [{
                                "training": "Yes",
                                "children": [{
                                    "type": 0,
                                    "value": 22.9
                                }, {
                                    "type": 1,
                                    "value": 0
                                }, {
                                    "type": 2,
                                    "value": 0
                                }, {
                                    "type": 3,
                                    "value": 19.7
                                }, {
                                    "type": 4,
                                    "value": 0
                                }, {
                                    "type": 5,
                                    "value": 15.8
                                }, {
                                    "type": 6,
                                    "value": 14.9
                                }, {
                                    "type": 7,
                                    "value": 0
                                }, {
                                    "type": 8,
                                    "value": 19.1
                                }]
                            }, {
                                "training": "No",
                                "value": 327.5
                            }]
                        }, {
                            "name": "非技術工人 Elementary occupations",
                            "children": [{
                                "training": "Yes",
                                "children": [{
                                    "type": 0,
                                    "value": 13.5
                                }, {
                                    "type": 1,
                                    "value": 0
                                }, {
                                    "type": 2,
                                    "value": 0
                                }, {
                                    "type": 3,
                                    "value": 12.2
                                }, {
                                    "type": 4,
                                    "value": 0
                                }, {
                                    "type": 5,
                                    "value": 10.2
                                }, {
                                    "type": 6,
                                    "value": 8.1
                                }, {
                                    "type": 7,
                                    "value": 0
                                }, {
                                    "type": 8,
                                    "value": 7.5
                                }]
                            }, {
                                "training": "No",
                                "value": 729.4
                            }]
                        }]
                    }

                    // create a list of keys
                    var keys_ch = ["對所售賣產品及提供服務的知識",
                            "員工訓練及輔導",
                            "領導才能及團隊合作",
                            "適應新工作程序或其他轉變的能力",
                            "人力資源管理",
                            "創意及創新",
                            "管理個人時間及編排個人工作",
                            "客戶服務技巧",
                            "其他特定工作技能",
                            "沒有接受培訓",
                            "曾接受培訓",
                            "所有僱員"
                        ]
                        // create a list of keys
                    var keys_en = ["Knowledge of products and services offered",
                        "Staff training and counselling",
                        "Leadership and teamwork",
                        "Ability to adapt to new work procedure or other changes",
                        "Human resource management",
                        "Creativity and innovation",
                        "Time management and work organisation",
                        "Customer service skills",
                        "Other job-specific skills",
                        "No training attended",
                        "Training attended",
                        "All employees"
                    ]

                    var rootNode = d3.hierarchy(data)
                    var packLayout = d3.pack();
                    packLayout.size([1000, 800]);
                    rootNode.sum(function(d) {
                        return d.value;
                    });
                    packLayout(rootNode);


                    var color = ["#eb5d0f", "#2718e6", "#980c2e", "#d997c6", "#bee544", "#7b64cf", "#c7a585", "#0a8920", "#CBB446"];


                    var svg = d3.select("#training-needs").append("svg")
                        .attr("width", 1200)
                        .attr("height", 1000)
                        .attr("class", "bubble")

                    var chart_group = svg.append("g");
                    chart_group
                        .attr("transform", "translate(-100,70)");


                    var tooltip = d3.select("body")
                        .append("div")
                        .style("opacity", 1)
                        .attr("class", "tooltip")
                        .style("background-color", "black")
                        .style("border-radius", "5px")
                        .style("padding", "10px")
                        .style("color", "white")
                        .style("white-space", "pre-wrap")


                    chart_group.selectAll('circle')
                        .data(rootNode.descendants())
                        .enter()
                        .append('circle')
                        .filter(function(d) {
                            return d.depth >= 1
                        })
                        .attr("fill", (d, i) => d.data.type != null ? color[d.data.type] : d.data.training == "No" ? "grey" : d.data.training == "Yes" ? "lightgreen" : "lightblue")
                        .attr('cx', function(d) {
                            return d.x;
                        })
                        .attr('cy', function(d) {
                            return d.y;
                        })
                        .attr('r', function(d) {
                            return d.r;
                        })
                        // .on("mouseover", (d) => console.log(d[1].reduce((a, b) => a + b).toFixed(1)));
                        .on("mouseover", (d) => tooltip.style("visibility", "visible").text(d.data.type != null ? keys_en[d.data.type] + "\n" + d.value.toFixed(1) + "k" :
                            d.data.training == "Yes" ? "Training attended" + "\n" + d.value.toFixed(1) + "k" :
                            d.data.training == "No" ? "No training attended" + "\n" + d.value.toFixed(1) + "k" :
                            "All employees" + "\n" + d.value.toFixed(1) + "k"))
                        .on("mousemove", function() {
                            return tooltip.style("top",
                                (d3.event.pageY - 10) + "px").style("left", (d3.event.pageX + 10) + "px");
                        })
                        .on("mouseout", function() {
                            return tooltip.style("visibility", "hidden");
                        });



                    var label_group = svg.append("g");
                    label_group
                        .attr("transform", "translate(0,20)");
                    label_group.append("text")
                        .attr("x", 35)
                        .attr("y", 710)
                        .attr("font-size", "12px")
                        .text("經理及行政級人員、專業人員與輔助專業人員")
                    label_group.append("text")
                        .attr("x", 35)
                        .attr("y", 725)
                        .text("Managers and administrators, professionals")
                    label_group.append("text")
                        .attr("x", 35)
                        .attr("y", 740)
                        .text("and associate professionals")


                    label_group.append("text")
                        .attr("x", 660)
                        .attr("y", 590)
                        .attr("font-size", "12px")
                        .text("文書支援人員")
                    label_group.append("text")
                        .attr("x", 660)
                        .attr("y", 605)
                        .text("Clerical support workers")


                    label_group.append("text")
                        .attr("x", 620)
                        .attr("y", 775)
                        .attr("font-size", "12px")
                        .text("服務工作及銷售人員")
                    label_group.append("text")
                        .attr("x", 620)
                        .attr("y", 790)
                        .text("Service and sales workers")


                    label_group.append("text")
                        .attr("x", 445)
                        .attr("y", 155)
                        .attr("font-size", "12px")
                        .text("工藝及有關人員、機台及機器操作員及裝配員")
                    label_group.append("text")
                        .attr("x", 445)
                        .attr("y", 170)
                        .text("Craft and related workers, plant and")
                    label_group.append("text")
                        .attr("x", 445)
                        .attr("y", 185)
                        .text("machine operators and assemblers")


                    label_group.append("text")
                        .attr("x", 10)
                        .attr("y", 130)
                        .attr("font-size", "12px")
                        .text("非技術工人")
                    label_group.append("text")
                        .attr("x", 10)
                        .attr("y", 145)
                        .text("Elementary occupations")


                    /* Title */
                    svg.append("text")
                        .attr("x", 8)
                        .attr("y", 25)
                        .attr("font-size", "22px")
                        .style('fill', '#808080')
                        .text("Top 5 cited training courses attended by employed persons for each")
                    svg.append("text")
                        .attr("x", 88)
                        .attr("y", 50)
                        .attr("font-size", "22px")
                        .style('fill', '#808080')
                        .text("occupation during the 12 months before enumeration")


                    /* Data source */
                    svg.append("text")
                        .attr("x", 0)
                        .attr("y", 950)
                        .attr("font-size", "16px")
                        .style('fill', '#808080')
                        .text("Data source: Census and Statistics Department, Hong Kong Government, 2018 Q1")


                    /* Legend */
                    var legend = svg.append("g");
                    legend
                        .attr("transform", "translate(630,-30)");

                    var legend_a = legend.append("g");


                    color.push("grey");
                    color.push("lightgreen");
                    color.push("lightblue");


                    // Add one dot in the legend for each name.
                    legend_a.selectAll("mydots")
                        .data(keys_ch)
                        .enter()
                        .append("circle")
                        .attr("cx", 100)
                        .attr("cy", function(d, i) {
                            return 100 + i * 40
                        }) // 100 is where the first dot appears. 25 is the distance between dots
                        .attr("r", 7)
                        .style("fill", function(d, i) {
                            return color[i]
                        })

                    // Add one dot in the legend for each name.
                    legend_a.selectAll("mylabels")
                        .data(keys_ch)
                        .enter()
                        .append("text")
                        .attr("x", 120)
                        .attr("y", function(d, i) {
                            return 100 + i * 40
                        }) // 100 is where the first dot appears. 25 is the distance between dots
                        .style("fill", function(d, i) {
                            return color[i]
                        })
                        .text(function(d) {
                            return d
                        })
                        .attr("text-anchor", "left")
                        .style("alignment-baseline", "middle");


                    var legend_b = legend.append("g");
                    legend_b
                        .attr("transform", "translate(0, 20)");


                    // Add one dot in the legend for each name.
                    legend_b.selectAll("mylabels")
                        .data(keys_en)
                        .enter()
                        .append("text")
                        .attr("x", 120)
                        .attr("y", function(d, i) {
                            return 100 + i * 40
                        }) // 100 is where the first dot appears. 25 is the distance between dots
                        .style("fill", function(d, i) {
                            return color[i]
                        })
                        .text(function(d) {
                            return d
                        })
                        .attr("text-anchor", "left")
                        .style("alignment-baseline", "middle");
                </script>


                <p class="bottom-one"></p>
                <p>Interpret your result here.</p>


                <p class="bottom-one"></p>
                <hr>
            </div>


            <div id="discussion">
                <h3 class="mb-4">Discussion</h3>


                <p class="bottom-one"></p>
                <hr>
            </div>



        </div>

    </div>

    <script src="js/jquery.min.js"></script>
    <script src="js/popper.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/main.js"></script>
</body>

</html>